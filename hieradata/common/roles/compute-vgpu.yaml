---
#
# Common vgpu settings
#

# Create and enable more swap
profile::base::common::extraswap:         true
profile::base::common::extraswap_sizegb:  10

# Nova overrides
#
# vgpu requirements: 32 GB, 4 vCPU, 20 GB per vGPU installed
#
nova::cpu_allocation_ratio:  '4'
nova::disk_allocation_ratio: '1'
nova::ram_allocation_ratio:  '1'

# Set trait to empty string by default
profile::application::create_mdev::trait: ''


# Influx
gpu_influxdb_bucket: "gpu"
profile::monitoring::telegraf::enable_telegraf:     true
profile::monitoring::telegraf::outputs:
  influxdb_v2:
    options:
      - urls: ["https://%{hiera('mgmt__address__influx')}:8086"]
        tls_ca: '/etc/puppetlabs/puppet/ssl/certs/ca.pem'
        token: "%{hiera('influxdb_admin_token')}"
        organization: "%{hiera('profile::monitoring::influxdb::org')}"
        bucket: "%{hiera('gpu_influxdb_bucket')}"
        insecure_skip_verify: true
        tagpass:
          bucket: ["%{hiera('gpu_influxdb_bucket')}"]

profile::monitoring::telegraf::inputs:
#  prometheus:
#    options:
#      - urls: ["http://%{::ipaddress_mgmt1}:9400/metrics"]
#        metric_version: 2
#        tags:
#          bucket: "%{hiera('ceph_influxdb_bucket')}"
  nvidia_smi:
    options:
      - tags:
          bucket: "%{hiera('gpu_influxdb_bucket')}"