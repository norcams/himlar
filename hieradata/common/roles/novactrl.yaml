---
include:
  default:
    - profile::openstack::novactrl
    - profile::logging::rsyslog::client
    - profile::openstack::openrc
    - profile::openstack::resource::host_aggregate
    - profile::openstack::cache

profile::base::selinux::manage_selinux:             true
profile::openstack::novactrl::manage_firewall:      true
profile::openstack::novactrl::memcached_source:     true
profile::openstack::novactrl::enable_api:           true
profile::openstack::novactrl::enable_conductor:     true
profile::openstack::novactrl::enable_scheduler:     true
profile::openstack::novactrl::enable_consoleauth:   true
profile::openstack::novactrl::manage_quotas:        true
profile::openstack::novactrl::manage_az:            true
profile::openstack::novactrl::manage_cells:         true

profile::openstack::openrc::password:     "%{hiera('nova_api_password')}"
profile::openstack::openrc::username:     'nova'
profile::openstack::openrc::project_name: 'services'

profile::openstack::novactrl::firewall_extras:
  source: "%{::network_trp1}/%{::netmask_trp1}"
profile::openstack::novactrl::memcached_source:
  source: "%{hiera('netcfg_trp_netpart')}.66,%{hiera('netcfg_trp_netpart')}.67,%{hiera('netcfg_trp_netpart')}.68"

profile::base::common::packages:
  'bash-completion': {}
  'bash-completion-extras': {}
  'jq': {}
  'openstack-selinux': {}

# Enable extra yum repo
profile::base::yumrepo::repo_hash:
  rdo-release:
    ensure: present
  epel: # should be absent when using RDO, but whitelist can also work
    ensure:   present
    includepkgs: 'htop bash-completion-extras'

# cache
memcached::max_memory:      '20%'
memcached::package_ensure:  'present'
memcached::service_enable:  true
memcached::service_restart: true
memcached::listen_ip:       "%{::ipaddress_trp1}"   
