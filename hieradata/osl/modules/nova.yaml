---
# Use ceph cluster for instance disk
nova::compute::rbd::ephemeral_storage:            true
nova::compute::rbd::libvirt_images_rbd_pool:      'vms'
nova::compute::libvirt::images_type:              'rbd'
#nova::compute::rbd::libvirt_images_rbd_ceph_conf: '/etc/ceph/ceph.conf'

# Optimize cache mode for ceph
nova::compute::libvirt::disk_cachemodes:
  - '"network=writeback"'

# set lowest common denominator for live migration compat
nova::compute::libvirt::cpu_mode:    'custom'
nova::compute::libvirt::cpu_models: ['Haswell-noTSX']

# Disable audits
nova::compute::instance_usage_audit:        false

# These policies will override the Nova policies set in common/modules/nova.yaml
# Disable reboot through api until DHCP is fixed upstream (calico)
nova::policy::policies:
  nova_disable_reboot:
    key:   'os_compute_api:servers:reboot'
    value: 'role:admin'
  nova_disable_suspend:
    key:   'os_compute_api:os-suspend-server:suspend'
    value: 'role:admin'
  nova_create_zero_disk_flavor:
    key:   'os_compute_api:servers:create:zero_disk_flavor'
    value: 'role:imagebuilder'
  # The below policies enable additional features for
  # iaas-team project (project_id: 8664497aa1224161bb1ed3bd88a65858)
  # or all users
  nova_enable_shelve:
    key:   'os_compute_api:os-shelve:shelve'
  #  value: 'project_id:e3dcca3452924794a6aebdd21b5da249'
    value: 'role:user'
  nova_enable_shelve_offload:
    key:   'os_compute_api:os-shelve:shelve_offload'
  #  value: 'project_id:e3dcca3452924794a6aebdd21b5da249'
    value: 'role:user'
  # unshelve is enabled by default for project member and admin
  nova_enable_unshelve_to_host:
    key:   'os_compute_api:os-shelve:unshelve_to_host'
  #  value: 'project_id:e3dcca3452924794a6aebdd21b5da249'
    value: 'role:user'
  # This allows specifying hypervisor with --host <FQDN>
  nova_enable_specify_host:
    key: "compute:servers:create:requested_destination"
  #  value: 'project_id:e3dcca3452924794a6aebdd21b5da249'
    value: 'role:user'
  # This allows specifying hypervisor with --availability-zone nova:<FQDN>
  # (old method)
  nova_enable_forced_host:
    key: "compute:servers:create:forced_host"
  #  value: 'project_id:e3dcca3452924794a6aebdd21b5da249'
    value: 'role:user'

